<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>安防星全景界面</title>

    <script src="../lib/require.js"></script>
    <script src="requirejs_config.js"></script>
    <link rel="stylesheet" type="text/css" href="../src/css/view.css"/>
    <link rel="stylesheet" type="text/css" href="../src/css/jquery.mCustomScrollbar.min.css">

    <script>
        require(['ids360Viewer', 'database', 'jquery'], function (ids360Viewer, database, $) {
            function getRequest(url) {
                var theRequest = new Object();
                var index = url.indexOf("?");
                if (index < 0) index = url.indexOf("#");
                if (index >= 0) {
                    var str = url.substr(index + 1);
                    var strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
                    }
                }
                return theRequest;
            }

            var param = getRequest(location.href);
            if (param.hideReturn) {
                $('#returnImg').remove();
                $('#fullscreenImg').remove();
                $('#exitFullscreenImg').remove();
            }

            window.addEventListener('hashchange', function () {
                var newParam = getRequest(location.hash);
                if (newParam.sceneIds != param.sceneIds) {
                    ids360Viewer.loadScenes(newParam.sceneIds, newParam.sceneId);
                    ids360Viewer.showScene(undefined);
                } else if (newParam.sceneId != param.sceneId) {
                    ids360Viewer.showScene(newParam.sceneId);
                }
                param = newParam;
            }, true);

            database.init("http://secpano.indoorstar.com:6628/sec/pano/", param.userSn, "2CC772253C0F8F35744437A03897564F");
            ids360Viewer.init(document);
            ids360Viewer.animate();
            if (param.stageId) {
                ids360Viewer.loadStage(param.stageId, param.sceneId);
            } else if (param.sceneIds) {
                ids360Viewer.loadScenes(param.sceneIds, param.sceneId);
            }
        });
    </script>

</head>
<body ondragstart="return false;" oncontextmenu="return false;">


<img id="returnImg" src="../res/img/view/return.png">
<img id="switchLayer" src="../res/img/view/switchlayer.png">

<img id="fullscreenImg" src="../res/img/view/fullscreen.png">
<img id="exitFullscreenImg" src="../res/img/view/exitFullscreen.png">

<!--地图图层-->
<div id="mapMarkerContainer" style="opacity:0;width:100%; height:100%;min-width:1px;min-height:1px;position: absolute;top: 0px;right: 0px;left: 0px;bottom: 0px;resize:both;z-index: 7;"></div>

<div id="mainDiv" style="opacity:0;height:100%">

    <img id="measureImg" src="../res/img/view/measure.png">
    <img id="editImg" src="../res/img/view/edit.png">
    <img id="selectImg" src="../res/img/view/selectPos.png">

    <img id="superpositionImg" src="../res/img/view/superpositionNoShow.png">
    <img id="infraredImg" src="../res/img/view/infraredNoShow.png">
    <img id="mapImg" src="../res/img/view/mapNoShow.png">
    <img id="panoramaImg" src="../res/img/view/panoramaShow.png">

    <!--编辑文字用的canvas-->
    <input type="text" id="textInput" class="textInput" autofocus="autofocus" width="auto" onkeypress="enterPress(event)"/>

    <div id="editDiv" style="display: none">
        <div id="spanDiv" class="editClass">
            <img id="backEditImg" src="../res/img/view/backEdit.png">
            <div id="picker-wrapper" style="display: none">
                <div id="picker"></div>
                <div id="picker-indicator"></div>
            </div>
            <div id="slider-wrapper">
                <div id="slider"></div>
                <div id="slider-indicator"></div>
            </div>
            <img id="textImg" src="../res/img/view/text.png">
            <img id="rubberImg" src="../res/img/view/rubber.png">
            <img id="lineImg" src="../res/img/view/line.png">
            <img id="waterImg" src="../res/img/view/water.png">
            <img id="fireHydrantImg" src="../res/img/view/fireHydrant.png">
            <img id="fireEngineImg" src="../res/img/view/fireEngine.png">
        </div>
    </div>
    <div id="measureDiv" style="display: none">
        <img id="distanceImg" src="../res/img/view/distance.png">
        <img id="heightImg" src="../res/img/view/height.png">
        <img id="areaImg" src="../res/img/view/area.png">
        <img id="backMeasureImg" src="../res/img/view/backEdit.png">
    </div>
    <div id="selectDiv" class="scrollBar">
    </div>



    <div id="heightDiv"></div>
    <div id="distanceDiv"></div>
    <div id="areaDiv"></div>
    <div id="textDiv"></div>

    <!--全景图层-->
    <div id="threeJsContainer" style="width:100%;height:100%;position: absolute;top: 0px;right: 0px;left: 0px;bottom: 0px;z-index: 5;"></div>
    <!--高德图层-->
    <div id="amapContainer" style="width:100%; height:100%;min-width:1px;min-height:1px;position: absolute;top: 0px;right: 0px;left: 0px;bottom: 0px;opacity: 0.7;pointer-events: none;z-index: 6;"></div>
</div>


</body>
</html>